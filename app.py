# coding:utf-8
import json
from flask import Flask, jsonify, make_response, request, Response
from requests_oauthlib import OAuth1Session
from twitter import Twitter, OAuth
from janome.tokenizer import Tokenizer
import collections
import re
from collections import Counter, defaultdict
import collections
import sys
import japanese_plaintext
import core
import emoji
import collections as cl


CONSUMER_KEY =  'kbIE5ZLubgsSDL1T73SQXH63J'
CONSUMER_SECRET = 'fCO2y2zwcHXgceNNWkE2DLSgy9rf53pOKS7E36YAA5PAKIQkXU'
ACCESS_TOKEN = '2811495061-3vMWEm62DhMuY2blPMgE7tEO4zRd7jdA0Z55XiQ'
ACCESS_SECRET = '3XzJUVD0bAV2WCoLUgpFd2hyDHguvfxGCfbGF3YfUJeMZ'

twitter = OAuth1Session(CONSUMER_KEY, CONSUMER_SECRET, ACCESS_TOKEN, ACCESS_SECRET)
url = "https://api.twitter.com/1.1/search/tweets.json"

app = Flask(__name__)
app.config['JSON_AS_ASCII'] = False

ignore_words = ['ä»Šæ—¥','æ—¥æœ¬','æœ¬æ—¥','ğŸ’•\u3000','ğŸ‘‹ğŸ˜†âœ¨â˜€ï¸','æ˜¨æ—¥','ãƒ»ãƒ»ãƒ»','æ—¥æœ¬äºº','ãƒãƒ§ãƒ­','u3000','ï½Â´âˆ‡ï½€ï¾‰','æ—¥æœ¬å›½æ°‘','äº‹ç„¡','æ¯æ—¥','ä¸€æ¾','æ™‚é–“','ä¸­å›½','ï½â™ª','å¤§äº‹','ä»Šå¹´','é˜ªç¥','å¹´æœˆæ—¥', 'æœ¬å½“','å…ƒæ°—','å¯æ„›','æ¾å…„','ä»•äº‹',
    'å†™çœŸ','æœ¬æ°—å‡º','\u3000æ—¥æœ¬äºº','éŸ“å›½','æœ€å¾Œ','ãƒ»ãƒ»ãƒ»ä»Šæ—¥','å¥³æ€§','å¹´å‰','ï½ä»Šæ—¥','ğŸ‘‹ğŸ˜ƒâ˜€ï¸','è‡ªåˆ†','æ˜æ—¥','æœ¬æ—¥æ™‚','ç·šé–‹æ¥­å‘¨å¹´','\u3000ãƒ»',
 'ä¸€æ—¥','ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»','æœ¬æ—¥åˆ†','ËŠáµ•Ë‹','å…¨æ–‡','ã‚«ãƒ©','å¤§äºº','æ—¥æœ¬é£Ÿ','â¾â¾','ğŸ‘‹ğŸ˜†âœ¨â˜€ï¸\u3000','\u3000æ€','ãƒˆãƒ‰','çŠ¯äºº',
 'å¥³ç¥ãƒãƒ§ãƒ­','é–‹æ¥­','é£Ÿäº‹åˆ¸','æœ¬å¹´','åæ§˜','æ²¢å±±','æ°—æŒ','å±±æœ¬','æ—¥æœ¬é…’','æŠ•ç¨¿','â˜…ä»Šæ—¥','ç™ºç”Ÿ','ä»Šåº¦','å¿œæ´','åæ—¥','ä¸€ä½“',
 'ï½ï½ï½','æ—¥æœ¬éŸ“å›½','æ—¥æœ¬ä¾µç•¥','å½¼æ°','æ—¥æœ¬èª','ç”·æ€§','ï½æ¯æ—¥','ã€œâ™ª','ã€œâ™ªä»Šæ—¥','æ—¥æœ¬ä»¥å¤–','å††åˆ†','å°å­¦ç”Ÿ','æ—¥ç›®','é…ä¿¡ä¸­','æ™®é€š','å¥³å­','è¨˜äº‹','â™ªæ˜¨æ—¥','ğŸ˜†ğŸ’•âœ¨ä»Šæ—¥','ä»Šæ—¥å¯Œå±±','ç„¡ç†','å­ä¾›','å‹•ç”»','ï½Â´âˆ‡ï½€ï¾‰ä»Šæ—¥','å‡ºä¼š','äººæ°—','é…’ä¼š',
 'å½“ç„¶','ä¸€æ˜¨æ—¥','åå››æ¾','å¯Œå±±','å…ˆç”Ÿ','æœ¬ç‰©','é–‹å‚¬ä¸­','æ„å‘³','æ¯æ—¥ãƒãƒ£ãƒ¬ãƒ³ã‚¸','ç¾å‘³','å…ˆç”Ÿæ§˜','ã‚³ãƒ¡ãƒ³ãƒˆ','æœ¬æ–‡','æ˜¯é','ç”»åƒ','é˜ªç¥é›»è»Š','æ§˜ï½ğŸ¤—ä»Šæ—¥','æœ€é«˜','è¿”ä¿¡',
 'æœ¬æ©Ÿ','ä»Šæ—¥ä»˜','èª•ç”Ÿæ—¥','ãƒ»ãƒ»ãƒ»åƒ•','å…ˆæ—¥','ä»Šæœˆåˆ†','ãƒ»ãƒ»ãƒ»â€ ','æœˆæ—¥é‡‘ï½æœˆæ—¥æœ¨',
 'å›½å¤–å›½äºº','ğŸ‘‹ğŸ˜†âœ¨â˜€ï¸\u3000æ˜¨æ—¥','æ‚ªæ¾','å¹´é–“ç”Ÿ','èª•ç”Ÿæœˆä½\u3000æœˆ\u3000â™”ä½\u3000æœˆä½\u3000æœˆä½\u3000æœˆä½\u3000æœˆä½\u3000æœˆä½\u3000æœˆä½\u3000æœˆä½\u3000æœˆä½\u3000æœˆä½\u3000æœˆä½\u3000æœˆç›¸æ€§ä¸€è¦§å¯¾',
 'ãƒ»ãƒ»ãƒ»é¡”','ğŸ¶ä»Šæ—¥','ğŸ’“ğŸ¤—','ä¸€äººç§°','å­äºº','å¤§äººæ°—','æ—¥æœ¬ä¸€æ˜Ÿ','ç„¡äº‹','ã€œâ™ªæœ¬æ¥','ä¸€ç·’','æ±ºå®š','ä»•äº‹çµ‚','è²´æ–¹','äººæ™‚é–“','ä¸€æ­©','ä»Šå¾Œ','æµ·å¤–æ—¥æœ¬','æœ€çµ‚æ—¥','ç±³æ—¥','ï½Â´âˆ‡ï½€ï¾‰æ°—',
 '\u3000è¦‹','å¹³æˆæœ€å¾Œ','å®Ÿè¡Œä¸­ä»Š','æ›´æ–°','å…¨åŠ›','çµ„é•·','æ¥æœˆ','ä»Šæ—¥å‡ºå‹¤','æ˜å¾Œæ—¥','æœæ—¥','ä½“èª¿æ‚ª','ç”Ÿç‰©','ç”¨äº‹','äººæ°—é«˜','Â´âˆ€ï½€','ä¿ºé”','å¹´é–“','æœ¬æ ¼','å¹³å‡','ä¸€æ—¥æ¨ª','ä»Šæ—¥ãƒ ãƒª','ä»•äº‹ä¸­',
 'ï½Â´âˆ‡ï½€ï¾‰\u3000å¯æ„›','ç‰©äº‹','èŠ±ç²‰ç—‡','\u3000ä½•','å‹é”','å§¿æ—¥æœ¬å›½æ°‘','ï½ï½ğŸ’“âˆ€','è¨˜å¿µ','äº‹å®Ÿ','é…ä¸‹æ°‘æ—¥æœ¬','æ—¥æ—…','åˆ¶é™',
 'å±±é–“éƒ¨','åº—å“¡','ä»Šå›','å›½ä¼š','æ™‚å…ƒæ°—','æ‰‹å‰\u3000','æ¯æ—¥æ¥½','æ¥µä¸»å¤«é“è©±','è»Šå‡º','ä»Šå¤œ','æœ¬ä¼ç”»æœ¬å½“','äººãƒ»ä»˜',
 'æ¼«ç”»','æœ‰åæ—¥æœ¬æ–™ç†åº—','å…ƒæ°—å‡º','äººé”','ï½ãƒ“ãƒ¼ã‚¨ãƒ«ãƒˆãƒªãƒ—ãƒ«ã‚µãƒ³ãƒ‰','ï½·ï½¬ï½¯','å±±è¡Œ','ï½ï½ğŸ’“Â´è‰¸ï½€','å¤œä¸­','â™ªä¸»å½¹','å¹´å¯„','ä¸–ç•Œ','æ‹æ„›','æœŸé–“ä¸­æ¯æ—¥åæ§˜','é‡ç”Ÿ','å°å­¦æ ¡',
 'ğŸ’–èª•ç”Ÿæ—¥','å¤§éŸ³é‡','ç›®ç·š','ç«äº‹','ä¸€ç†','ã‚·ã‚³ãƒ¡ãƒ¢','ä»•æ–¹','Â´ãƒ»Ï‰ãƒ»ï½€ã‚³ãƒ¼ã‚¯ã‚ªãƒ³','æœ€å¼·','ç¥æ§˜','å‡ºæ¥','è¨˜å¿µæ—¥','é›»æ°—','ä¹…ã€…','å°ç”Ÿ','æ¼«ç”»\u3000','äºŒæ—¥ç›®',
 'ç›¸å¤‰','éƒ¨å±‹','æ—¥é–“é€£ç¶š','é€£ä¸­','ï½¼ï½´ï¾˜ï½²ï½ªï½¯ï½½ï½¼ï½´ï¾˜ï½²ï½ªï½¯ï½½','é›»è©±','â¾â¾å¤§åˆ†å…ƒæ°—','ç‰©ç†çš„','ğŸ’–ã€ƒ','Î£ãƒ»âˆ€ãƒ»','æ­£ç›´è€…','ä»ŠæŠ•','ä½“è‚²é¤¨','â¤ï¸ğŸ¤—',
 'æœªæ¥','ç”Ÿæ”¾é€ä¸­','æ‰‹ä¼','ç”Ÿä¸­ç¶™','çµ„å½“','æ˜¨æ—¥åŒæ§˜','æ„›è»Š','ä¸­å¿ƒ','ç´ æ•µ','å›½é€£','ä»•ä¸Š','åŒäººèªŒ','ğŸ’•\u3000å¯æ„›','ç”Ÿç”£','ä»Šå¹´åˆ','ï½Â´âˆ‡ï½€ï¾‰\u3000ç¶¾å¤','ğŸ‘‹ğŸ˜†âœ¨â˜€ï¸\u3000çœŸä¾','ä½œå“','æ¬¡éƒ',
 'æ—¥æœ¬äººï¼®ï½çµ¦æ–™', 'æ¯å­','ï½â™ªæ·±å¤œé™å®šâ˜…æ´¾ç”Ÿï¼¢ï¼¬æ¾',
 'æ—¥æœ¬åœ°å›³ï½ãƒãƒ«ã‚³ãƒãƒ¼ãƒ­', 'å¤–å‡º', 'å¥åº·', 'æ³•å­¦éƒ¨ç”Ÿ', 'è–æ­Œãƒˆãƒ‰', 'å›½æ°‘', 'é˜ªç¥é›»è»Šä¹—è»Šä¸­', 'ç¬‘ç¬‘', 'æ¯æ—¥ä¸‡åæ§˜', 'æ‹äºº', 'å°å­¦ç”Ÿç”·å­', 'è»Šä»¥å¤–', 'å½“æ™‚', 'å®‰å®š', 'æ–‡å­—ä¸­', 'ï½±ï½°ï½°ï½°ï½°ï½°ï½°ï½°ï½°ï½°ï½°ï½°', 'æ‰‹è¡“ä¸­', 'é–‹æ¥­å‘¨å¹´', 'æ§˜å­', 'ç†ç”±', 'å¹³æ°—','å¿ƒé…',
 'ç”»é¢', 'é£Ÿæ¬²', 'æ˜¨æ—¥ä»•äº‹ä¼‘', 'ç¾å®Ÿ', 'æ©Ÿæ', 'å¤§ä¼š', 'ç›¸è«‡', 'è¥¿æ­¦', 'ä¸€éƒ¨å¹³é‡éƒ¨', 'ä»Šæ—¥å½©çŸ¢', 'æš´åŠ›', 'ä¸€è¦‹', 'â™ªæ·±å¤œé™å®šâ˜…æ´¾ç”Ÿï¼¢ï¼¬æ¾', 'æ–°è»Š', 'ğŸ’“\u3000å‡›å­', 'ä¸€åº¦', 'å•é¡Œ', 'ã€œâ™ªæ·±å¤œé™å®šâ˜…æ´¾ç”Ÿï¼¢ï¼¬æ¾', 'é è·é›¢æ‹æ„›', 'åå‰', 'è·é›¢æ„Ÿ', 'å¤–é£Ÿè¡Œ', 'å……å®Ÿ', 'æ©Ÿå†…','ï½å‡›å­',
 'èª•ç”Ÿæ—¥ãƒ­ãƒ¬ãƒƒã‚¯ã‚¹', 'ç¥çˆ¶ã‚«ãƒ©', '\u3000æœ€çµ‚è©±', 'è¦–è´ç‡æ—¥æœ¬', 'ç·šé–‹æ¥­å‘¨å¹´çŠ¯äºº', 'å¾Œè€…', 'ä¸€æ­©è¸', 'å’Œæ­Œå±±æ¥', 'å‰è€…', 'ï¼¢ï¼¬æ¾', 'å­é”', 'æµè¡Œ', 'é…ä¿¡ä¸­åªä»Š', 'ç·å‹¢åæ§˜', 'ã€œâ™ªâ™ªâ™ªãƒã‚¡ãƒã‚¢ã‚ªã‚«ã‚º', 'ç™ºè¨€', 'å®Ÿè¡Œ', 'ä¸€ä½“ä½•', 'é£Ÿä¸­æ¯’åˆ†', 'æ·±å¤œé™å®šâ˜…æ´¾ç”Ÿï¼¢ï¼¬æ¾', 'æ‰‹é–“', 'äº¤é€šæƒ…å ±ã‚¢ãƒŠ', 'ğŸ’–ä¸­ã€…ä¼š', 'è»Šé«˜èª¿', 'ä¹—è»Š','çŠ¬æ§˜',
 'ä»¥å‰', 'ä¿®æ‚¦ä½“', 'å¥³å­åŠ›é«˜', 'å¹´é–“çŸ¥', 'å‡ºç™º', 'æ¥å ´', 'äºŒäºº', 'è¡Œå‹•', 'å’Œæ­Œå±±', 'ç”Ÿæ”¾é€', 'æ•°æ™‚é–“', 'é£Ÿäº‹åˆ¸å††åˆ†', 'Ã—å°', 'æ³¨æ„ä¸‹', 'ä¸‹è»Š', 'ä½•æ•…', 'å¹´é‡‘', 'ç”¨é€”', 'å›½å†…æœ‰æ•°', 'ç²¾æ°—', 'ä»Šé€±', 'ä»Šæœ', 'ä¸€äººæš®', 'ğŸ’–æ°—','äººãƒ»å¸¸è­˜',
 'ç²¾ç¥', 'å†…ç”°', 'é€±é–“é™å®š', 'ä¸€åˆ‡ç„¡', 'å…¬æ–‡', 'é ­ç—›', 'é¢ç™½', 'ï½è·å ´', 'ç”Ÿåˆ¶ä½œ', 'å½¼å¥³å‡ºæ¥', 'ï¾€ï¾ï½§', 'ãƒ½Â´âˆ€ï½€ï¾‰', '\u3000èª°', 'å®Ÿéš›', 'é€šå‹¤', 'ğŸ¶âœ¨ğŸ˜†âœ¨ğŸ¶','ä¸‡äºº',
 'é•·å¥³', 'ã€œåœ°å…ƒå’Œæ­Œå±±', 'â¾â¾æœªæˆå¹´', 'æˆ‘ã€…', 'ä»Šãƒˆãƒ‰', 'å§‹å‹•\u3000æ–°ç·šåŠ›', 'ä¹—å®¢', 'æ¯æ—¥æŒ‘æˆ¦', 'ï½ï½ğŸ’“Â´è‰¸ï½€å³ä¿å­˜', 'å¼·åˆ¶ä½¿ç”¨æ–™å¾´åæ—¥æœ¬', 'å­ä¾›ç”¨', 'â–³æ·±å¤œé™å®šâ˜…æ´¾ç”Ÿï¼¢ï¼¬æ¾', 'åœŸæ›œæ—¥ä¹…ã€…', 'æœ¬æŠœ', 'å†™çœŸå‡º', 'ãƒ•ã‚©ãƒ­ãƒ¼', 'é¸æŒ™', 'ç”Ÿæ¯', 'äº¬æ€¥', 'ç•œç”Ÿ', 'æ‚ªç”¨', 'å°è¦‹å‡º', 'â™ªç¾å‘³', 'èŠ±ç²‰', 'è‡ªä¿¡','ä¸æº€',
 'å£å†…ç‚', 'ä¸åº¦å¹´å‰', 'ç‹æ§˜', 'ç¥çˆ¶', 'å®Ÿæ–½', 'åä¹—', 'æ‚ªå¾³äºº', 'æœˆä¸€ãƒ‘ãƒ³ã‚¯', 'å¯Œå±±å¸‚ä¸­å¤®é€š', 'å®Ÿè³ªç„¡æ–™', 'æœ‰å', 'æ„›æƒ…', 'æ¥å ´è€…æ•°', '\u3000ç”˜', 'è‡ªè»¢è»Š', 'æ ¡å†…', 'å’Œæ­Œå±±å¸‚', 'åŸ¼ç‰', 'æ™‚æœŸ', 'ä»®é¢ãƒ©ã‚¤ãƒ€ãƒ¼', 'å¹´å……é›»', 'ä¸€è¨€', 'ä¹—è»Šä¸­ã‚³ãƒ¡ãƒ³ãƒˆ', 'â™ªåƒ•', 'å…¨ç„¶', 'æ”»é”ç£¨', 'ä¼Šè±†å¤§å³¶', 'åœ¨åº«æœ¬', 'ç ‚é˜²', 'è‚²å…ä¸­', 'è¥¿æ´‹äºº','æ™‚ä»¥å¤–ãƒˆãƒ‰',
 'é˜ªç¥ä¹—', 'å­ä¾›é”', 'ç”»åƒé€', 'è¨˜äº‹å®Œæˆå¾Œ', 'é£Ÿä¸­æ¯’ç¶šå‡ºä¸­ã‚­ãƒ ãƒ', 'è¥¿æ´‹å¤ç‰ˆæ—¥æœ¬åœ°å›³', 'æ‹æ„›ç›¸æ€§', 'å¿…è¦', 'ä»¥ä¸Š', 'å¯Œå±±çœŒå†…æ°—è±¡æƒ…å ±', 'ä¼šè¨ˆç„¡æ–™', 'å¿ƒç†', 'å¯Œå±±é§…', 'ä»Šå¾Œã‚¹ãƒãƒ›', 'å›å…ƒæ°—', 'æœ‰åæ¼«ç”»', 'ÎµÂ´âˆ€ï½€ï¾ï½¯', 'æ™‚ã€œç’°æ°´å…¬åœ’å†…', 'é•·å¥³å°å­¦æ ¡', 'ç¡çœ æ™‚é–“', 'è¦‹å½“', 'æ©Ÿé•·', 'æ–°ç”Ÿæ´»å¿œæ´', 'è­¦éƒ¨çŠ¯äºº', 'çŠ¶æ…‹', 'è¿‘é‰„ç‰¹æ€¥', 'åŒç´šç”Ÿ','å…±ç”£å…š',
 'å…¬åœ’', 'è¡—é ­æ¼”èª¬', 'æ–‡å­—', 'æš´å‹•äº‹ä»¶', 'æ–‡å­—ä»¥ä¸‹', 'ç›¸æ‰‹', 'ä¸€æ™‚é ', 'â™ªâ–½', 'ä½ä¿º', 'å…ƒé»’éƒ¨å¸‚é•·', 'ãƒ¡ãƒ‡ã‚£ã‚¢', 'ä½œè€…', 'è§£æ”¾', 'è»Šå‹æ‰‹', 'é•·ç”·', 'å­¦æ ¡', 'â¤ï¸', 'æ”¿åºœ', 'å˜èª¿æ¸›å°‘æ—¥æœ¬èªè…', 'ã€œæ™‚é ƒé£Ÿ', 'ï¼§ï¼¯\u3000é›»è»Šãƒ»ãƒã‚¹', 'é”æˆæ¯', 'ï½ç¬‘é¡”', 'æ§˜ï½‚\u3000è¤’ç¾', 'æœ‰åŠ¹æ´»ç”¨å‡ºæ¥', 'é»’éƒ¨å††',
 'æ¥é¤¨', 'ä½“èª¿è‰¯', 'ã€œâ™ªç‰›ä¹³', 'å¤šåˆ†ä¿¡', 'åŠ è¶Šèƒ½åŠ è³€ãƒ»è¶Šä¸­ãƒ»èƒ½ç”Ÿè²·', 'ï½ã‚®ã‚·ã‚®ã‚·', 'æ°·è¦‹', 'æœ€è¿‘', 'æ˜¯éæ¥', 'æ™‚ä»£', 'åæ—¥ãƒ¡ãƒ‡ã‚£ã‚¢', 'å¯Œå¯Œå¯Œ', 'å°å…¥', 'å—ä¿¡æ–™', 'â€•ä¸­å›½ãƒ¡ãƒ‡ã‚£ã‚¢', 'ä¿è­·è€…ä¼š', 'ä¸å‘‚ä»‹', 'é§æ­¦å¤–ä¼\u3000å…¬å¼', 'æ­»ç¥', 'â¾â¾æœŸå¾…', 'ä¸­æ­¢', 'ä¸¸ä»Šå›', 'ğŸ¥–ä»Šå›', 'äºˆå®šé€š', 'ã€œâ™ªå…¨ç„¶ã‚¤ã‚¤', 'è»Šå†…è¡¨ç¤º',
 'é–‹å‚¬', 'æ˜ ç”»', 'ä¸­ç¶™ä¿¡å·', 'ä¿³äºº', 'ä¸Šæ‰‹', 'ï½ğŸ’•ğŸ˜´', 'ä¸€è¶³å…ˆ', 'å ±é“', 'ğŸ‘‹ğŸ˜ƒâ˜€ï¸é ‘å¼µ', 'åˆ¶ä½œæ±ºå®š', 'å¹´ç´ æ•µ', 'ä¼šè©±', 'å¯Œå±±çœŒç¾è¡“é¤¨', 'å’åœ’å¼æ˜æ—¥', 'ç”Ÿä¹³ä½¿ç”¨ç‰›ä¹³', 'äººé£Ÿå™¨æ£š', 'ç±³å­', 'â¾â¾æš‡', 'ä¸€åˆ»', 'é›†é‡‘æ—¥å›ãƒã‚¤ãƒ­ãƒ¼ã‚¼', 'ãƒ¾â—Â´âˆ€ï½€â—ï¾‰', 'é€šè©±', 'å„ªé›…', 'ä¹…ä¿ç”°æ‚ æ¥','é»’éƒ¨å¸‚',
 'é ­æ°—æ¸©', 'ä»Šã‚·ãƒ¼ã‚ºãƒ³', 'é–‹å‚¬ä¸­ğŸ–', 'é£›è¡Œæ©Ÿ', 'é£Ÿå™¨', 'æ–°é…’', 'ä¸‹æ‰‹', 'è²´æ§˜', 'ä¸€ä»¶ä»¥æ¥ãƒ«ãƒãƒ¼', 'æ°—åœ§', 'â™ªï¼¢ï¼¬ï¼´ã‚µãƒ³ãƒ‰', 'å¤§åˆ‡', 'å‹¿ä½“ç„¡', 'åå‰æŒ™', 'ï½ãƒã‚­ãƒ³ã‚¿ãƒ„ã‚¿', 'ï½ãƒ–ãƒ¬ãƒ¼ã‚­ãƒ­ãƒ¼ã‚¿ãƒ¼', 'æ´»ç™º', 'è»Šä¸¡', 'åŒè¡Œ', 'åº—é•·', 'é‡çƒéƒ¨', 'ä¿è‚²åœ’', 'è‡ªè»¢è»Šä»˜', 'ã€œâ™ªãƒ¢ãƒ¼ãƒ‹ãƒ³ã‚°ã‚»ãƒƒãƒˆ', 'ãƒ„ã‚¤ãƒ¼ãƒˆ', 'æ™‚åŠ', 'ä½“å‹¢', 'ãƒ†ã‚£ãƒƒã‚·ãƒ¥', 'é¤“æ­»å¯¸å‰ãƒ»æœ€å¾Œ', 'é™å®šãƒ‘ãƒƒã‚±ãƒ¼ã‚¸', 'å¹´â€•', 'å¤¢ä¸­', 'ä¿¡å·ç„¡è¦–', 'å…¬ç´„è€…', 'ï½¥Ï‰ï½¥',
 'åº—æ¥å§‹', 'æ¥é€±', 'æœ€åˆ', 'æ‹æ„›ç›¸è«‡ä¹—', 'äººãƒ•ã‚©ãƒ­ãƒ', 'å»ƒäºº', 'è‚‰é£Ÿ', 'è©¦é¨“ä¸­', 'â™ªã‚®ã‚·ã‚®ã‚·', 'æ„Ÿè¬', 'æ­£è§£', 'è§£æ±º', 'é§…å‰', 'é«˜è²´', 'â™ªåŠ›ä»»', 'å»ºç‰©æ²¢å±±', 'å½¼å¥³', 'ä½•åº¦', 'ç„¡é˜²å‚™','ç·šå…¨é§…','åœ°é…’æ¨ªä¸ï½','é™ç•Œ','ç†æ€§å¤±','å¹³å±±éƒå¤«ç”»ä¼¯','å’Œæ­Œå±±ã‚µã‚¤ã‚¯ãƒªãƒ³ã‚°ãƒ•ã‚§ã‚¹ã‚¿ã‚¨ã‚¤ãƒ‰','å’Œæ­Œå±±ã‚µã‚¤ã‚¯ãƒªãƒ³ã‚°ãƒ•ã‚§ã‚¹ã‚¿','æ™‚èµ·','ç„¡è‡ªè¦š','å¦–ç²¾ç•Œ','ç„¡é™ãƒ«ãƒ¼ãƒ—','ä¸€é€”','ä¸€æ¯','äºˆå®š','ä»•äº‹ç–²','æœ¬éŸ³æœ‰çµ¦å¹´é–“ï¼¾Ï‰ï¼¾ï½€ï½©ï½¤ï½©ï½¤é¨™','éå»',
 'é–¢é€£æ€§','æœ‰æ–™é“è·¯ä½¿','æœ‰æ©Ÿæ°´éŠ€','â¾â¾ã‚¹ãƒ†ãƒƒã‚«ãƒ¼','ç™¾ç”°å°šæ¨¹æ°å¤–å›½äºº','æ™‚ã€…å¿˜','é€£æŠ•','è¿·å­','ä¿ºæ§˜','çŸ¥è­˜','ç¾ä¹…','å›½æ°‘ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆ','ä¸æ­£ç•™å­¦è€…',
 'æ”¿æ²»å®¶','ç„¡æ•µ','å…¨é§…','æˆä¹³ä¸­','å¿…è¦ç„¡','ç­‹è‚‰ç—›','æ€§æ ¼å—','é»’éƒ¨å·','éƒ¨å±‹åŒ–','æš´å‹•','çœŸå„ª','éŸ“å›½ãƒŠãƒã‚¹','éŸ“å›½å‚¾','å¹¼ç¨šåœ’åœŸæ›œæ—¥','æ–¹æ³•','ä½“é¨“','æ˜ ç”»é¤¨','åœ°é…’','è¦‹ç›´',
 'é›°å›²æ°—å‡º','â˜…â˜†ç¨½å¤å ´é€šä¿¡â‘ â˜†â˜…','æƒ³åƒä»¥ä¸Š','å¤§å¤‰','ä¸€æ™‚åœæ­¢','æ”»æ’ƒè¡Œå‹•','é–‹å§‹','é•·é‡çœŒ','ãƒ¶æœˆ','ç³–åˆ†','â¸å…ƒã€…æ˜','äºŒäººæš®','ä¼šè¨ˆçµ‚','å¹³å’Œ','ç„¡é–¢ä¿‚å†™çœŸ',
 'é˜ªç¥è¥¿å®®ï½´ï¾‹ï¾ï½½ï¾€è¥¿å®®å‰','éå»æœ€é«˜','ã€œæ¡ä»¶ã€œãƒ»å¹³å‡ã‚­ãƒ«','æ©Ÿå†…ã‚¢ãƒŠã‚¦ãƒ³ã‚¹','å€‹æ€§','æ°´ç™ºå£²','ã€œâ†’','é‡åº¦','ç´ ç›´','å •å¤©','æ¿€æ€’','æ˜¼é£Ÿå¾Œ','äººä»¥ä¸Šå·¦ç¿¼','ä¹…ä¿ç”°æ‚ æ¥ä»®é¢ãƒ©ã‚¤ãƒ€ãƒ¼','æ€§æ ¼é‡è¦–','ç—…æ°—',
 'å¯’æ°—','äº”åƒå††ï½','å°æ²¢ä¸€éƒæ—©','ç”»åƒæ·»ä»˜','æœ‰çµ‚','ç”·å¥³å·®','å¤§åƒç§‹æ¥½å…¬æ¼”','ä¼šç¤¾','è§£èª¬','å¤šåˆ†','é›»è©±è¶Š','å¿ƒç†çš„','å˜ä½“','åˆå›æ”¾é€','ä¸æ­£','å›è¨€','è·é›¢','å—ä¿¡æ–™å•é¡Œ',
 'æœèµ·','è£åˆ‡','å…¥åº—','å €å†…åº·ç”·æ°','ä¸€ç•ªå¥½','ä¸€è¶³æ—©','æƒ…å ±è§£ç¦','å¦å®š',"é ‘å¼µ","ã‚¹ãƒãƒ›", "ç”·å­", "ãƒ•ã‚©ãƒ­ãƒ¼"]

remove_words = ["ã€œ", "ï½—", "ãƒ»", "ğŸ¥º", "â™¡", "â˜†", "â™ª", "ç¬‘", "â€»"]

userTweets = []


def get_userstweets(user_id, tweet_id):
    t = Twitter(auth=OAuth(
        ACCESS_TOKEN,
        ACCESS_SECRET,
        CONSUMER_KEY,
        CONSUMER_SECRET
    ))

    remain = True
    max_id = tweet_id
    remainNum = 0
    numberOfTweets = 100
    count = 50
    while remain:
        aTimeLine = t.statuses.user_timeline(user_id = user_id, count=count, max_id=max_id)
        for tweet in aTimeLine:
            userTweets.append(tweet['text'])
        max_id = aTimeLine[-1]['id']-1
        remainNum = numberOfTweets - len(userTweets)
        count = remainNum
        if len(userTweets)+1 > numberOfTweets:
            #print(userTweets)
            remain = False



@app.route('/')
def index():
    return 'Hello World!'

@app.route('/post', methods=['POST'])
def post_json():
    req_json = request.get_json()  # Get POST JSON
    key_word = req_json['key_word']

    params = {'q' : key_word, 'count' : 15}
    req = twitter.get(url, params = params)
    
    if req.status_code == 200:
        search_timeline = json.loads(req.text)
        for tweet in search_timeline['statuses']:
            user_id = tweet["user"]["id"]
            tweet_id = tweet["id"]
            get_userstweets(user_id,tweet_id)

    # è¤‡åˆèªã‚’ã¤ãã‚‹
    texts = ','.join(userTweets)
    texts=re.sub(r'https?://[\w/:%#\$&\?\(\)~\.=\+\-â€¦]+', "", texts)
    texts=re.sub('RT', "", texts)
    texts=re.sub('ãŠæ°—ã«å…¥ã‚Š', "", texts)
    texts=re.sub('ã¾ã¨ã‚', "", texts)
    texts=re.sub(r'[!-~]', "", texts)#åŠè§’è¨˜å·,æ•°å­—,è‹±å­—
    texts=re.sub(r'[ï¸°-ï¼ ]', "", texts)#å…¨è§’è¨˜å·
    texts=re.sub('\n', "", texts)#æ”¹è¡Œæ–‡å­—
    texts = ''.join(c for c in texts if c not in emoji.UNICODE_EMOJI) #çµµæ–‡å­—ã®é™¤å»
    texts = ''.join(c for c in texts if c not in remove_words) #remove_wordsã‚’é™¤å»

    # è¤‡åˆèªã‚’æŠ½å‡ºã—ã€é‡è¦åº¦ã‚’ç®—å‡º
    frequency = japanese_plaintext.cmp_noun_dict(texts)
    LR = core.score_lr(frequency,
            ignore_words=japanese_plaintext.IGNORE_WORDS,
            lr_mode=1, average_rate=0.1
        )
    term_imp = core.term_importance(frequency, LR)

    # é‡è¦åº¦ãŒé«˜ã„é †ã«ä¸¦ã¹æ›¿ãˆã¦å‡ºåŠ›
    important_words = []
    important_score = []
    data_collection = collections.Counter(term_imp)
    for cmp_noun, value in data_collection.most_common():
        if value > 10000000:
            if core.modify_agglutinative_lang(cmp_noun) in ignore_words:
                continue
            else:
                important_words.append(core.modify_agglutinative_lang(cmp_noun))
                important_score.append(value)
                
    #jsonå½¢å¼åŒ–ã—ã¦å‡ºåŠ›
    # ys = cl.OrderedDict()
    ys = {}
    for i in range(500):
        #data = cl.OrderedDict()
        data = {}
        data["ID"] = i
        data["importance"] = important_score[i]
        ys[important_words[i]] = data

    result_json = json.dumps(ys, ensure_ascii=False, indent=4)
    return result_json


if __name__ == "__main__":
  app.run(host="0.0.0.0")
